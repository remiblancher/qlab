# =============================================================================
# Encryption Certificate Profile (ML-KEM-768)
# =============================================================================
#
# Usage: Key encapsulation certificate for CMS EnvelopedData
#
# This certificate contains an ML-KEM public key for quantum-safe
# key encapsulation. Used to encrypt session keys in CMS EnvelopedData.
#
# IMPORTANT - RFC 9883 CSR Attestation:
#   You cannot prove possession of a KEM key by signing a CSR!
#   KEM keys encapsulate, they don't sign.
#
#   Workflow:
#   1. First obtain a SIGNING certificate (signing.yaml profile)
#   2. Generate ML-KEM key pair locally
#   3. Create CSR signed by your SIGNING key (attestation)
#   4. CA verifies CSR signature and issues encryption certificate
#   5. Encryption cert includes RelatedCertificate pointing to signing cert
#
# Standards: FIPS 203 (ML-KEM), RFC 5280 (X.509), RFC 9883 (CSR Attestation)
# Security Level: NIST Level 3 (~192-bit equivalent)
# Quantum Safety: FULLY PROTECTED
#
# Example (CSR workflow):
#   # Step 1: Generate CSR (signed by signing key)
#   pki cert csr --algorithm ml-kem-768 \
#       --keyout alice-enc.key \
#       --var cn="Alice" \
#       --attest-cert alice-sign.crt \
#       --attest-key alice-sign.key \
#       -o alice-enc.csr
#
#   # Step 2: CA signs the CSR
#   pki cert issue --ca-dir ./encryption-ca \
#       --csr alice-enc.csr \
#       --profile profiles/encryption.yaml \
#       --out alice-enc.crt
#
# =============================================================================

name: encryption

description: "Encryption Certificate ML-KEM-768 (FIPS 203)"

# -----------------------------------------------------------------------------
variables:
  cn:
    type: string
    required: true
    description: "Recipient name (e.g., 'Alice')"

# -----------------------------------------------------------------------------
algorithm: ml-kem-768

# -----------------------------------------------------------------------------
validity: 365d

# -----------------------------------------------------------------------------
subject:
  cn: "{{ cn }}"
  c: "FR"
  o: "Demo Organization"

# -----------------------------------------------------------------------------
extensions:

  # Basic Constraints
  basicConstraints:
    critical: true
    ca: false

  # Key Usage (key encapsulation only)
  keyUsage:
    critical: true
    values:
      - keyEncipherment

  # Extended Key Usage
  extKeyUsage:
    critical: false
    values:
      - emailProtection
